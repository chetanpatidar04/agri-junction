{% extends 'base.html' %}
{% block content %}
{% load cart%}
{% load custom_filter%}

{% if request.session.cart_msg %}
<script>
    alertify.set('notifier', 'position', 'top-right');
    var delay = alertify.get('notifier', 'delay');
    alertify.set('notifier', 'delay', 2);
    alertify.success("{{request.session.cart_msg}}");
    alertify.set('notifier', 'delay', delay);    
</script>
{% endif %}
<div class="container-fluid mt-3">
    {% if order_placed %}
    <div class="container-fluid  mt-100">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart</h5>
                    </div>
                    <div class="card-body cart">
                        <div class="col-sm-12 empty-cart-cls text-center">

                            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPMAAADPCAMAAAAXkBfbAAAAwFBMVEX///8AAAAAqRJoaGgApwDZ2dm9vb0PDw99fX0ApQDm5ubr6+unp6dRUVEAowAAqAD39/fLy8vw+vHw8PCfn58lJSXFxcXf39+Dg4MWFha2trZjY2PQ0NBDuUuJiYlwcHAvLy9LS0vj9eXI6suYmJjq9+tbW1uL0ZCurq6u37HZ8dtDQ0M6OjozMzNPT09sxnKk26hJu1CZ2J4fsCt0yHkeHh5fw2Z/y4Or26645LzE58ZQvVcytTyJ0Y7c8t4nsTHFMlSUAAAL/ElEQVR4nO2daUPiPBDHoQa0qJyieKycXqiLguJ6POv3/1YPIGA7nSSTNEdX/b3xBdL2T67JzGSay/2j1PvPfy4eRtPpdPQ0/vM89P08lqk/X9xXymEYshVhWC4H03Hf95NZ4u/411xskISF5cr07sz3A5qmtxCM6P3UzaZXdd+PaZD+qCIUvJI9eer5flRDvLyiPRojrIz+yi7XKJ5uRTjdK9YKDRc66AxfCU0caezKg3hgDzbzSQ5v20cHjgRJqT+Q23itOhgLLniOKF7S2dt2pkvAVaCqeE74xl20t/iS5xwXXKrDqE/LGornTR1ymrogljxX7bet+1qNvGzqX+i6JWnmBTuudUa4C7UVz5s6wPp3k6A5f+5tFn/S7NefTf2cvChFcj7f9DSFT1O18ofo5KDG1imEzRMPinOv6SXPRF/Ay+7SNOc3Pczfr/qzl1D0JVFzvuN8TBuSjHRvqub8uWPJIxMdeyn6Kn7pE7Jot0vWhTnJM9HAnVAji3ZpnDynXaTiVMCWo3FKWqTz+bY7yb2KUckBe0vcolSIUtsfnKM/g7tV+s3U/LUifJLftFo79tjQ/5kczB+USR7CQjch2tF6NTQvOWAT2r0HUPOeXa0rjPfsOZTePQeKbtrVuiTdXopLReok+wAOahezWD2VMr7fjE1p99/20LnTTGBscnfBFQ0tEx6ncc23duXOOdNXHLD72QWGFY5q9kp7gpLzmTuF0bmQLBBNbWjgFi1aVLugPtGWHP5aXmPIseKoIxpsNresiV1ypd3Ma8kz0bzeTYvqlOKelI4dpZ/c667NLOrk7OMtnfSZ4HSdrla8FlKTzBX9TnsKMHNbHtC6CxWDruwX9McjzmJgf215n/FLr53ZW8J7/4wG5mkGaPUwLnrTLPnL6M16es2MSOaIJu40fuetEnOojrU0s3c0RoNdrEwzunfsao7da6rTtdkET6fAlvrwjqSZ7iXUoRN7Spk6dIxyJKOTA9UsIcY69NiI3qkn9PyFwQPSD/iS0fWqQtOMeInMMYjeSWiELYKMiYmJTXhZFHXU9VCmpRWRYx06xLzm/H3gvJUXcVWw7gok4xZd+ELSDPdWRonZOKIprLIMJfejuyY24VnQdc5KH/4haabHdzSIBTwFjjC2tqCGn5kH6pIDRjS5KckIupSiN+J78qNG49+VaBZwJXN/PerEfWRRczV6I+60HfdOn00WiliFK3nC94r94nwHUHWk+YynGU489XemKZm8tcp13GgecjQnk0JmfZcv+UwkmWpxw/2kLc19fHmG4eMF91x3dU8oOQiImvfjz7m5ZY7obXDNDDWR61zJ7xKbnagZDuiq/Cs6oJqpE+0SqWSqZphqc6Qsh0QfG8/sQeUSso6toBkErlrqeihw5jCFFPSePFOSOofBtNBHHUVy8LWKvZNFEyST16rEgLaUWoLP2/x9BKBXkbtZlrEOChtxzZfyb+jAiz8EJNE9Xswmdq0R+Wn24po35N/QgWclM5j3g8GL2IBLifL34xyAzp1CmIARd2cgn8i4kbk4qIGDUwXmp530T77PgL9rXEKUTI5NzmnHNdsJvj/z5yA2EXppyen8RN/QArCf7KaVh3ImmHeFovvEVg7oJkku6SCSfmFbaKA20OC9MPgsEE2XrGbVXcc114T/XGp3Dpu7+7yP924eH2+w4cGdxISiOUFIDKJPfwlwEA1E/7uK652in1aXP99NsieI06Q4szdnC4pSVjo4C/aTN4J//bTa0JZeT4fJGGdP3EdR0SqSkVxXEXBAC8zPz/nuGPm0sY6LHCavIUnOR5wjLyphParXc0U3rpk7WKNRvV3k00jOWSnxoSwwmRAtWN4QQsUiAMBBJMimSaFZmrgdBrGJDA0y838xotNzDUg4EKTHpdAsj8ayqGg1ydhhKzENkHDAz6ZJo1neV9lk3UGvVMPVyuUOQMIB30GURjMhkXktWlWymkGygLyfTKWZkMm8PPqpnD7H1MuYgISDW65xmUozJfmRVfoaad6KHtQPQMIBd0Cn0kzTwqbqhyk1mjmR78rdT6bTnJO7awNOaon4G+qjOZdIOMCMLBOalSwrBbRq1AAH0SMvmTulZnOnQ6Mor81L4przvEPRaTWfWdCsbIKtAA4ifKuYXrONkzch8dRNAuAg4h0PTq1ZLx9QRFnJVxClATo3Z0Cn1yzMFNBAa2le8hjXzNlPptesn7uOS8aTYGmA/SRnQBvQnOJcBgL1CB1KMa6Z4yAyodnkQXcVPz4CaUAb0Zx7MiWaIXVZVOjGNePxSTOacw9mRDN6hAoHJBzgDiJDms20dGrJcD95aFWzgTHNKik7di6ZcIDuJ41pTm2Q4YWlVAEJ7GjREnOacy8pyofNjxMaqfcJHEToftKg5tzZvX5Tl4nH+WVQEg5Map67+TXPmRkYyh9UQeUSbD9pVnNu+KbR1Kw8MlfQFewnsfikYc2zqYweUl8SvpusWAwcRJj5aVxzrv6k5P8KA+2tIwqMTyIe388xj7oJu6tPVRI0eg+CkhTxXh1OxobrFFdBwgG2n2wtP8Nd4OvAlzhXAXI2fpOrZozdW6jMDBIO0P3kYBHb2uD4FGqLn+1aTfKM+ssowItvrwSHb09WSq6D/WQH/adG7bIoGK2Fy0u9DLP688MbWnR8ppfd/ze0VHwbDmjyRGSIeu/q6XUSrqrLz/6EZfY+unixWWO9G9dsvXwHRr0+fL4bjy8uLsbjq5ee9drqrbhmh+Xj/AESDjq+n8cF2yDhwHu5aheAAW0pgT1bAAcRNz75lQAOoqal41aZApYs+RYDGiQcCPNdvwqgZInr8sVeAEfMkFzVL0hcMzfhwC6rqbN6UDva2UKywc0CHERZAHPJGMVmhQNNeIkexoB1PzOAsgdCGas1iLSwX4WzJX8ItzhYL4vyp3CL9eFst2SJFvaHcy5341skwIVZlKhH7hfrq/Mc+ismnOBgOOfsFthSx80rHQTvsXOP9dLJH2RpQP92I5nwJjtnWCoRk6QK8l27G35oDxwGjwgJB18O4CBy8+4MzygciP4yVIH5+S3CGSDhwE75jowBzc+MvT/ZCg2wWn2Lzg3yXa99P48LoPfzO8SttoEn0JGl7xe4t/oOSzT0BLrZufsFBqKd54r5AFbm/g5R2cQm2tGbCb3ShaK9ZAW6ZR9q/g7W2G1C9LGnl7+7I9nQs5ls5+Brp08lRvSCzm57cFSrnRQKB0sKVvDTp+CBK8c0Wz6MP4vF9mkIKtZZIzmNOcZFHBbguXfnrdX3F+E9i8iH9Wf59W1SvHho9uTPZZOOD82eu7enGErB4jtxpIgK6VrF4zrtzz9T2pA/nR18umdKftradxi41nqUP6RZnKUZCNje32lfN6F70BY3PsxtDtVS4aS2P6N4tKBohf3vEDv54Ycffvjhhx/0qBZPu/MUhM3fp/sGXFWFwcaimNVteyersd6DeIC2lc7tXt2Jpd7tZjEG2Ei+LLqVoq2PmvBq134OpArYx3ZVTd3HrB4jV8taBgfPAaoXoN3m+JvOsxQB5Ls/0fqQEra5O3FXZxEIiA4Uqu9y4asOo2SmPAhM6I6jHD4UeteykrfSFWpWbRqJxzwbK7XsqKxa7xb17DnZyMpKrKQAtSONl5KrOTo5J+ZE9pBqab9d2dWykFCbtL8gKrYEIaZtTQkdeYUDlVWVEOj0b4NSKlkoHNggFEDRMXPMguWJQRTWl2v51fzXIaQEoOmrVSJJGsG/AUrRzH9rH4RSIsJb0HkNRTN9v/9vaKYULKHnccHK5hj+LTG5SaK0zdiVX82/64DQGw8V1ipCbR/67GANeQ6Nys6KMD1kwOCW13RQMSLkJs6mNSV0xB6DOUpeA9T7F8V3EskCWcESNbtJWucmEyePZVshxfEnmbn9z9oLxHOtal8U1z85zIq7V5S8rp56K9xOekhTxxH07keNUxOC/WRW3J45gTG2qbWYcufujAzmDwq4ndzU9Mxy/E0ZauU5DcwT39aecDDvZzMzY3lNEc5k12mSE7cTg3qQlRk7RjFqnRynTccsnUa8i529TCpeUNtpbZxvtHbMdMODo0H7/Li9d2TkyNz/6gj5B0gphSkAAAAASUVORK5CYII="
                                class="img-fluid mb-4 mr-3 mt-3" alt="Responsive image">
                            <h3><strong>Order placed !!!</strong></h3>
                            <h4>Payment Method : Cash On Delivery</h4>
                            <!-- <h4>Cash on Delivery</h4> -->
                            <a href="/" class="btn btn-dark cart-btn-transform m-3" data-abc="true"> <i
                                    class="fa fa-chevron-left"></i> Continue Shopping</a>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    {% elif cart_empty.flag %}
    <div class="container-fluid  mt-100">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart</h5>
                    </div>
                    <div class="card-body cart">
                        <div class="col-sm-12 empty-cart-cls text-center">
                            <img src="https://www.freepnglogos.com/uploads/shopping-cart-png/shopping-cart-svg-png-icon-download-28.png"
                                width="130" height="130" class="img-fluid mb-4 mr-3 mt-3">
                            <h3><strong>Your Cart is Empty</strong></h3>
                            <h4>Once you have added items to your shopping cart</h4>
                            <h4>You will be able to place order</h4>
                            <a href="/" class="btn btn-dark cart-btn-transform m-3" data-abc="true"> <i
                                    class="fa fa-chevron-left"></i> Continue Shopping</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    {%csrf_token%}
    <div class="border border-secondary rounded p-4 m-4">
        <div class="card border mx-auto">
            <div class="p-3 card-header text-primary">
                <h4>My Cart ({{request.session.cart.keys|length}})</h4>
            </div>
            <div class="card-body text-dark">
                <p class="card-title"><i class="fa fa-mobile fa-2x mr-4" aria-hidden="true"></i>Mob Number :
                    {{request.session.mob_number}}</p>
                <p class="card-text"><i class="fa fa-truck fa-flip-horizontal fa-2x mr-2"></i> Delivery Address :
                    {{request.session.address}},
                    Pincode : {{request.session.pincode}}</p>
                <a href="#" data-toggle="modal" data-target="#exampleModal"
                    class="btn btn-secondary btn-sm rounded col-sm-3 float-right">Change address or Mob number</a>

                <div class="modal fade" id="exampleModal" tabindex="-1" role="dialog"
                    aria-labelledby="exampleModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-light">
                                <h5 class="modal-title" id="exampleModalLabel">Change address or Mob number</h5>
                                <hr>
                                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <div class="modal-body">
                                <div class="modal-body">
                                    <form action="/cart" method="POST">
                                        {%csrf_token%}
                                        <input hidden type="text" name="update_address" id="" value={{True}} readonly>
                                        <div class="form-group">
                                            <label for="">Mobile No</label>
                                            <input type="text" name="mob_number" id="" class="form-control"
                                                value="{{request.session.mob_number}}" aria-describedby="helpId">
                                        </div>
                                        <div class="form-group">
                                            <label for="">Address</label>
                                            <input type="text" name="address" id="" class="form-control"
                                                value="{{request.session.address}}" aria-describedby="helpId">
                                        </div>
                                        <div class="form-group">
                                            <label for="">Pincode</label>
                                            <input type="text" name="pin_code" id="" class="form-control" placeholder=""
                                                value="{{request.session.pincode}}" aria-describedby="helpId">
                                        </div>
                                        <input type="text" name="order_page_flag" id="" class="form-control"
                                            value="True" aria-describedby="helpId" readonly hidden>
                                        <input type="submit" class="btn btn-outline-dark col-lg-5 float-right"
                                            value="Submit">
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <hr>
        <div class="row">
            <div class="col-sm-9">
                {% for product in products %}
                <div class="card  mt-3" id={{product.id}}>
                    <div class="row no-gutters">
                        <div class="col-md-4">
                            <img style="height: 150px; width:265px; object-fit: contain; "
                                class="rounded mt-2 ml-2 mb-2 bg-white" src="{{product.image.url}}" alt="">
                        </div>
                        <div class="col-md-8">
                            <div class="card-body mb-2">
                                <form action="/cart#{{product.id}}" method="post">
                                    {% csrf_token %}
                                    <input hidden type="text" name='product_id' value='{{product.id}}'>
                                    <h5 class="card-title text-primary ">{{product.name}}
                                        <button type="submit" class=" btn text-secondary float-right" title="Remove"><i
                                                class="fa fa-trash"></i></button>
                                    </h5>
                                </form>
                                <h6 class="card-text">{{product.description}}</h6>
                                <h6>Pack Size : {{product.pack_size}}</h6>
                                <div class="mb-2">
                                    <!-- <button style="height:25px; width: 30px;" class="btn btn-sm"><i
                                            class="fa fa-minus"></i></button>-->
                                    <!-- <div class="row no-gutters ">-->
                                    <form action="/cart" method="post">
                                        {% csrf_token %}
                                        <div class="row no-gutters float-left">
                                            <input hidden type="text" name='prod_id' value='{{product.id}}'>
                                            <input hidden type="text" name='reduce' value='True'>
                                            <button type="submit" style="height:25px; width: 35px;"
                                                class="btn btn-sm"><i class="fa fa-minus"></i></button>
                                    </form>
                                    <input style="height:25px; width: 35px;" class="text-center" id="product"
                                        value="{{product|cart_quantity:request.session.cart}}" readonly>
                                    <form action="/cart#{{product.id}}" method="post">
                                        {% csrf_token %}
                                        <input hidden type="text" name='prod_id' value='{{product.id}}'>
                                        <button type="submit" style="height:25px; width: 35px;" class="btn btn-sm"><i
                                                class="fa fa-plus"></i></button>
                                    </form>
                                </div>
                                <div class="row float-right">
                                    <h6 class="mr-3 mb-3">{{product|price_total:request.session.cart|currency}}</h6>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            {%endfor%}
            <hr>
            <div class="m-2 p-2 mt-2">
                <form action="/checkout" method="POST">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-dark rounded col-lg-3 float-right mr-2 mt-2">
                        Place Order </button>
                    <a href="/" class="btn btn-outline-dark border rounded col-lg-3 float-right mr-2 mt-2"><i
                            class="fa fa-chevron-left"></i> Continue Shopping</a>

                </form>
            </div>
            </form>
        </div>
        <div class="col-sm-3 mx-auto mt-3">
            <div class="card bg-light mb-3 " style="max-width: 18rem;">
                <div class="card-header text-primary">
                    <h4>Price Details</h4>
                </div>
                <div class="card-body text-dark">
                    <h6 class="float-left">Sub-Total</h6>
                    <h6 class="float-right">{{products|total_cart_price:request.session.cart|currency}}</h6>
                    <h6 class="float-left">Delivery Charge</h6>
                    <h6 class="float-right">Free</h6>
                </div>
                <div class="card-footer ">
                    <h6 class="float-left ">Amount Payable</h6>
                    <h6 class="float-right">Free</h6>
                </div>
            </div>
        </div>
    </div>
</div>
{% endif%}
{% endblock %}